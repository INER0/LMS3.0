{% extends 'base.html' %}

{% block title %}Delete Book - Library Management System{% endblock %}

{% block page_header %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="text-white mb-0">
            <i class="fas fa-trash-alt me-2"></i>Delete Book
        </h1>
        <p class="text-white-50 mb-0">Confirm book deletion</p>
    </div>
    <div>
        <a href="{% url 'library:manage_books' %}" class="btn btn-glass">
            <i class="fas fa-arrow-left me-1"></i>Back to Books
        </a>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-6">
        <div class="glass-card p-4">
            <div class="text-center mb-4">
                <i class="fas fa-exclamation-triangle text-warning display-1 mb-3"></i>
                <h4 class="text-white">Are you sure you want to delete this book?</h4>
                <p class="text-white-50">This action cannot be undone.</p>
            </div>
            
            <div class="glass-card bg-danger bg-opacity-10 border border-danger border-opacity-25 p-3 mb-4">
                <h5 class="text-white mb-3">
                    <i class="fas fa-book me-2"></i>{{ object.title }}
                </h5>
                
                <div class="row">
                    <div class="col-sm-6">
                        <p class="text-white-50 mb-1"><strong>ISBN:</strong></p>
                        <p class="text-white mb-2">{{ object.isbn }}</p>
                    </div>
                    <div class="col-sm-6">
                        <p class="text-white-50 mb-1"><strong>Category:</strong></p>
                        <p class="text-white mb-2">{{ object.get_category_display }}</p>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-sm-6">
                        <p class="text-white-50 mb-1"><strong>Authors:</strong></p>
                        <p class="text-white mb-2">
                            {% for author in object.authors.all %}
                                {{ author.name }}{% if not forloop.last %}, {% endif %}
                            {% empty %}
                                No authors
                            {% endfor %}
                        </p>
                    </div>
                    <div class="col-sm-6">
                        <p class="text-white-50 mb-1"><strong>Publisher:</strong></p>
                        <p class="text-white mb-2">{{ object.publisher.name }}</p>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-sm-6">
                        <p class="text-white-50 mb-1"><strong>Publication Year:</strong></p>
                        <p class="text-white mb-2">{{ object.publication_year }}</p>
                    </div>
                    <div class="col-sm-6">
                        <p class="text-white-50 mb-1"><strong>Language:</strong></p>
                        <p class="text-white mb-2">{{ object.get_language_display }}</p>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-sm-6">
                        <p class="text-white-50 mb-1"><strong>Section:</strong></p>
                        <p class="text-white mb-2">{{ object.section.name }} ({{ object.section.branch.name }})</p>
                    </div>
                    <div class="col-sm-6">
                        <p class="text-white-50 mb-1"><strong>Edition:</strong></p>
                        <p class="text-white mb-0">{{ object.edition|default:"Not specified" }}</p>
                    </div>
                </div>
            </div>
            
            <!-- Check for related data -->
            {% if object.bookcopy_set.exists %}
            <div class="alert alert-warning" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Warning:</strong> This book has {{ object.bookcopy_set.count }} cop{{ object.bookcopy_set.count|pluralize:"y,ies" }} in the system.
                Deleting this book will also delete all its copies and related circulation records.
            </div>
            {% endif %}
            
            <form method="post" class="d-flex justify-content-end gap-2 mt-4">
                {% csrf_token %}
                <a href="{% url 'library:manage_books' %}" class="btn btn-secondary">
                    <i class="fas fa-times me-1"></i>Cancel
                </a>
                <button type="submit" class="btn btn-danger" onclick="return confirmDeletion()">
                    <i class="fas fa-trash-alt me-1"></i>Yes, Delete Book
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function confirmDeletion() {
        return confirm('Are you absolutely sure you want to delete this book? This action cannot be undone and will remove all copies and related records.');
    }
    
    // Add keyboard shortcut for escape to go back
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            window.location.href = "{% url 'library:manage_books' %}";
        }
    });
</script>
{% endblock %}
